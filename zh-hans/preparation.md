## 1.通信安全

Hub系统和前置系统通过ECC保障通信安全，所以都需要配置对方的公钥在自己系统内，在接收信息时用公钥进行验签。

在该场景下，前置系统需要调用拥有高级权限的sudo API，即app ID是sudo。sudo的作用是使用最高权限的APP ID来调用特殊API，包括钱包业务，AML流程对接，ST业务等。具体请参考[API文档](https://shimo.im/sheets/loqeWmQme2tXmzAn/MODOC)。

前置系统需要开启sudo功能并为sudo配置通信公钥，方可使用。方法如下：
1. 登陆Admin系统，前往"高级管理" -> "系统设置"
2. 点击“系统设置”栏，在"sudo接口配置"模块下，点击启用，并在"sudokey配置"设置通信公钥。

## 2.设置根公钥

因为所有需要离线签名的地址的种子被保管在Cold Signer，为使在线系统可以获取离线种子衍生出的地址，需要将离线种子衍生出的根公钥从Cold Signer导出，并配置在Seed Vault中，这样在线系统就可以根据这一个根公钥用衍生路径推演出所有衍生的公钥和地址。步骤如下：
1. [初始化Cold Signer](cold-signer-tutorial.html)
2. [导出根公钥](cold-signer-tutorial.html)
3. 将根公钥设置在Seed Vault，key是root_xpub，[设置方法](seed-data.html)

## 3.用户钱包默认设置

在此场景下，所有用户钱包应共同使用一套运营设置，不能被单独定制化，共享设置如下：

  * 区块链开关
  * 代币开关
  * 发交易手续费相关设置（手续费倍率、gas价格上限......）
  * 补充手续费空投地址，即运营专用热钱包的热主地址

这些设置都需要在使用该模式前，提前设置完毕，方能继续使用。设置方法：
1. 前往钱包页面，点击左下角“设置”按钮进入
2. 点击右侧按钮进入查看离线签名模式的模版
3. 编辑“区块链 & 代币”设置

## 4.运营专用热钱包

根据需求，所有用户钱包消耗的手续费都由运营方承担，所以运营热钱包的作用是，承担该使用场景下资金流转所需要消耗的所有手续费。运营热钱包由充值地址、热主地址和冷钱包地址组成。

* 充值地址作为AML隔离层，充值通过AML后由前置系统发起请求汇总到热主地址
* 热主地址是热签名，有余额控制设置，自动向冷钱包转账。是**唯一的**向用户钱包地址补充手续费的来源
* 冷钱包是单独设置的由人工控制的钱包，不由Hub系统控制

1. 调用Hub接口创建运营钱包（钱包模式是全托管，API传入mode=safe）
2. 调用Hub接口生成ETH充值地址
3. 运营人员手动向充值地址充值两笔ETH，一笔用做该充值地址资产转移到主地址的手续费，下文称作充值1。另一笔是转移到主地址的资产用于负担整个场景的手续费，下文称作充值2。
4. 两笔充值的结果Hub系统会发送通知。不需要对充值1做任何后续处理，不要通过AML并请求汇总到热主地址，否则会陷入没有手续费的死循环。然后前置系统调用Hub系统接口请求将充值2转移到主地址。
5. 转移成功后，充值2的金额将作为所有用户钱包和运营钱包本身的手续费。

Hub系统中可以有多个运营热钱包，但只能有一个可以作为补充手续费的钱包。设置方法：
1. 前往钱包页面，点击左下角“设置”按钮进入
2. 点击右侧按钮进入查看离线签名模式的模版
3. 编辑“支付手续费钱包”设置，只能搜索选择“全托管模式”的钱包


## 5.回调通知地址

设置回调地址，可通过API “/v2/s/utilities/set_callback”设置，也可在界面上设置。设置方法：
1. 前往“高级管理” -> “系统设置” -> “系统配置”
2. 在“通知配置”模块下，设置所有订单类型的通知地址。**注意：该场景下前置系统需要解析所有订单类型的回调。**